/**
 * The HASH is a very convenient way to deal with the browser history.
 * You can use the `:target` CSS selector, but there are few annoying caveats.
 * This module is a watcher for hash changes. Just pass it a callback as argument.
 * It will be called as soon as the hash changed.
 */

var lastHash = "?" + Date.now();
var timer = 0;
var slot = null;
var args = [];

module.exports = function(arg_slot) {
  slot = arg_slot;
  if (!timer) {
    timer = window.setInterval(
      function() {
        var hash = window.location.hash;
        if (lastHash == hash) return;
        lastHash = hash;
        if (typeof slot === 'function') {
          if (hash.charAt(0) == '#') {
            hash = hash.substr(1);
          }
          while (hash.charAt(0) == '/') {
            hash = hash.substr(1);
          }
          args = hash.split("/");
          slot.apply(slot, args);
        } else {
          // Stop timer.
          window.clearTimeout(timer);
          timer = 0;
        }
      },
      50
    );
  }
};


module.exports.args = function() {
  return args;
};
