{"intl":"var _=function(){var D={\"en\":{\"bad-repo\":\"Unable to contact this repository!\",\"confirm-exit\":\"Are you sure you want to exit this application?\",\"download-progress\":\"Downloading in progress: $1\",\"exit\":\"Exit\",\"install-progress\":\"Installation in progress: $1\",\"loading\":\"Downloading application files...\",\"network-error\":\"<html>An error occured while trying to contact repository <b>$1</b>.<pre class='error'>$2</pre><hr/>A good network connection is mandatory for the first installation.\",\"repository\":\"Repository's URL\"},\"fr\":{\"bad-repo\":\"Le dépôt spécifié ne répond pas !\",\"confirm-exit\":\"Êtes-vous sûr de vouloir quitter cette application ?\",\"download-progress\":\"Téléchargement en cours: $1\",\"exit\":\"Quitter\",\"install-progress\":\"Installation en cours: $1\",\"loading\":\"Téléchargement de l'application...\",\"network-error\":\"<html>Une erreur est survenur lors de la tentative de connexion au dépôt <b>$1</b>.<pre class='error'>$2</pre><hr/>Une bonne connexion réseau est indispensable lors de la première installation.\",\"repository\":\"URL du dépôt\"}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n","src":"/** @module tolokoban-nw */require( 'tolokoban-nw', function(require, module, exports) { var _=function(){var D={\"en\":{\"bad-repo\":\"Unable to contact this repository!\",\"confirm-exit\":\"Are you sure you want to exit this application?\",\"download-progress\":\"Downloading in progress: $1\",\"exit\":\"Exit\",\"install-progress\":\"Installation in progress: $1\",\"loading\":\"Downloading application files...\",\"network-error\":\"<html>An error occured while trying to contact repository <b>$1</b>.<pre class='error'>$2</pre><hr/>A good network connection is mandatory for the first installation.\",\"repository\":\"Repository's URL\"},\"fr\":{\"bad-repo\":\"Le dépôt spécifié ne répond pas !\",\"confirm-exit\":\"Êtes-vous sûr de vouloir quitter cette application ?\",\"download-progress\":\"Téléchargement en cours: $1\",\"exit\":\"Quitter\",\"install-progress\":\"Installation en cours: $1\",\"loading\":\"Téléchargement de l'application...\",\"network-error\":\"<html>Une erreur est survenur lors de la tentative de connexion au dépôt <b>$1</b>.<pre class='error'>$2</pre><hr/>Une bonne connexion réseau est indispensable lors de la première installation.\",\"repository\":\"URL du dépôt\"}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n    /**\r\n * This is an application container.\r\n * It manages updates in background.\r\n */\r\n\r\n\"use strict\";\r\n\r\nvar $ = require(\"dom\");\r\nvar DB = require(\"tfw.data-binding\");\r\nvar Err = require(\"tfw.message\").error;\r\nvar Text = require(\"wdg.text\");\r\nvar Wait = require(\"wdg.wait\");\r\nvar Modal = require(\"wdg.modal\");\r\nvar Local = require(\"tfw.storage\").local;\r\nvar Button = require(\"wdg.button\");\r\n\r\nvar FS = require(\"node://fs\");\r\nvar Path = require(\"node://path\");\r\n\r\nvar g_rootFolder = Path.resolve('.');\r\nvar g_config;\r\n\r\nfunction get(key, def) {\r\n    return Local.get('tolokoban-nw' + '/' + key, def);\r\n}\r\n\r\nfunction set(key, val) {\r\n    return Local.set('tolokoban-nw' + '/' + key, val);\r\n}\r\n\r\n\r\nexports.start = function() {\r\n    Modal.alert(\"Start debugger now!\", function() {\r\n        FS.readFile(\"package.json\", function(err, out) {\r\n            if( err ) {\r\n                Err( \"<html>Unable to read/parse <b>package.json</b>: <code>\" + err.message + \"</code>\" );\r\n                return;\r\n            }\r\n            try {\r\n                var jsn = out.toString();\r\n                g_config = JSON.parse( out.toString() );\r\n            } catch( ex ) {\r\n                Err(\"Bad JSON syntax in `package.json`!\");\r\n                return;\r\n            }\r\n            $('title').textContent = g_config.name + \" \" + g_config.version;\r\n\r\n            var pkg = get( 'install' );\r\n            debugger;\r\n            if( pkg ) installPackage( pkg ).then( execApp );\r\n            else checkFirstLaunch();\r\n        });\r\n    });\r\n};\r\n\r\nexports.onExit = exitApp;\r\n\r\n/**\r\n * Check if it is the first launch or not.\r\n */\r\nfunction checkFirstLaunch() {\r\n    return new Promise(function (resolve, reject) {\r\n        getPackageDef().then( downloadPackageIfNeeded )\r\n        .then( showIndexPage );\r\n    });\r\n}\r\n\r\n/**\r\n * Open the page `index.html` in the IFrame.\r\n */\r\nfunction showIndexPage() {\r\n    $('iframe').setAttribute( 'src', 'index.html' );\r\n}\r\n\r\n/**\r\n * Promise which resolves in an URL of the repository.\r\n */\r\nfunction getRepositoryUrl() {\r\n    return new Promise(function (resolve, reject) {\r\n        var repository = get( 'repository' );\r\n        if( repository ) return resolve( repository );\r\n        var repo = new Text({\r\n            label: _('repository'), wide: false, width: '30rem',\r\n            value: 'http://localhost/www/Cameroun/index.php'\r\n        });\r\n        var loading = new Modal({ padding: true, content: [new Wait({ text: _('loading') })] });\r\n        var ok = Button.Ok();\r\n        var exit = new Button({ text: _('exit'), icon: \"close\", type: 'simple' });\r\n        exit.on( exitApp );\r\n        var content = $.div([\r\n            repo, ok,\r\n            $.tag('hr'),\r\n            $.tag('center', [exit])\r\n        ]);\r\n        DB.bind( repo, 'action', ok, 'fire' );\r\n        var modal = new Modal({ padding: true, content: content });\r\n        modal.attach();\r\n        window.setTimeout(function() {\r\n            repo.focus = true;\r\n        }, 300);\r\n        ok.on(function() {\r\n            resolve( repo.value.trim() );\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Resolves in the URL of the repo and the ID of the package.\r\n * `{ repo: <string>, id: <string> }`\r\n */\r\nfunction getPackageUrl( repoUrl ) {\r\n    return new Promise(function (resolve, reject) {\r\n        set( 'repository', repoUrl );\r\n        var pkgId = get( 'id' );\r\n        if( pkgId ) resolve( repoUrl + \"?\" + pkgId );\r\n        // Ask the repository the list of packages.\r\n        fetch( repoUrl ).then(function(response) {\r\n            if( !response.ok ) throw { message: response.status + \": \" + response.statusText };\r\n            return response.json();\r\n        }).then(function( packagesList ) {\r\n\r\n            // @TODO Manage the case of multi packages by adding a selection screen.\r\n            resolve({\r\n                repo: repoUrl,\r\n                id: packagesList[0].id\r\n            });\r\n        }).catch(function(err) {\r\n            manageNetworkFailure( repoUrl, err ).then( resolve );\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Network errors are ignored if the first installation has already occured.\r\n * That means if the `version` storage attribute has already been set.\r\n */\r\nfunction manageNetworkFailure( url, err ) {\r\n    return new Promise(function (resolve, reject) {\r\n        console.error( \"Unable to contact \", url, \" because of error \", err );\r\n        if( get('version') ) resolve( null );\r\n        else {\r\n            Modal.alert(_('network-error', url, err.message), function() {\r\n                set('repository', null);\r\n                set('id', null);\r\n                set('version', null);\r\n                location.reload();\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Resolves in a package definition or `null`.\r\n * A package definition has this format:\r\n * ```\r\n * {\r\n *   url: <string>\r\n *   version: <string>\r\n *   files: [<string>, ...]\r\n * }\r\n * ```\r\n */\r\nfunction getPackageDef() {\r\n    return new Promise(function (resolve, reject) {\r\n        getRepositoryUrl().then( getPackageUrl ).then(function( pkgUrl ) {\r\n            var url = pkgUrl.repo + \"?\" + pkgUrl.id;\r\n            fetch( url ).then(function( response ) {\r\n                if( !response.ok ) throw { message: response.status + \": \" + response.statusText };\r\n                return response.json();\r\n            }).then(function(pkgDef) {\r\n                resolve(pkgDef);\r\n            }).catch(function(err) {\r\n                manageNetworkFailure( url, err ).then( resolve );\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * If `get(\"version\")` is missing  or different from `pkg.version`, we\r\n * must download the package files.\r\n * It  `get(\"version\")` is  not  missing, the  downloads  will run  in\r\n * background. Otherwise, we will wait for all the downloads to finish\r\n * before resolving.\r\n */\r\nfunction downloadPackageIfNeeded( pkg ) {\r\n    // Check existence of download folder.\r\n    mkdir(\"tolokoban-nw/download\");\r\n\r\n    var downloadedFiles = [];\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            console.info(\"[tolokoban-nw] pkg=\", pkg);\r\n            if( pkg.files.length == 0 ) {\r\n                pkg.files = downloadedFiles;\r\n                // @TODO Mettre dans le bon parametre.\r\n                Local.set('tolokoban-nw/install666', pkg);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('download-progress', pkg.files.length);\r\n            var file = pkg.files.pop();\r\n            mkdir( 'tolokoban-nw/download/' + Path.dirname( file ) );\r\n            var url = pkg.url + file;\r\n            fetch( url ).then(function(response) {\r\n                if( !response.ok ) {\r\n                    throw Error(response.status + \" \" + response.statusText + \" - \" + url);\r\n                }\r\n                downloadedFiles.push( file );\r\n                return response.arrayBuffer();\r\n            }).then(function(arrayBuffer) {\r\n                var output = Path.resolve(Path.join(g_rootFolder, \"tolokoban-nw/download/\", file));\r\n                var data = new Buffer( arrayBuffer );\r\n                console.info(\"[tolokoban-nw] output=\", output);\r\n                console.info(\"[tolokoban-nw] arrayBuffer=\", arrayBuffer);\r\n                FS.writeFile( output, data, function( err ) {\r\n                    if( err ) throw Error(\"Unable to write file: \" + output + \"\\n\" + err);\r\n                    next();\r\n                });\r\n            }).catch(function(err) {\r\n                manageNetworkFailure( url, err ).then( resolve );\r\n            });\r\n        };\r\n\r\n        next();\r\n    });\r\n}\r\n\r\n/**\r\n * Close the mian window, hence exit the application.\r\n */\r\nfunction exitApp() {\r\n    Modal.confirm(_('confirm-exit'), function() {\r\n        nw.Window.get().close();\r\n    });\r\n}\r\n\r\n/**\r\n * Execute the application by loading `index.html` page.\r\n */\r\nfunction execApp() {\r\n    $('iframe').setAttribute( 'src', 'index.html' );\r\n}\r\n\r\n/**\r\n * Install package stored in `/tolokoban-nw/package`.\r\n */\r\nfunction installPackage( pkg ) {\r\n    return new Promise(function (resolve, reject) {\r\n        alert('TODO!');\r\n    });\r\n}\r\n\r\n/**\r\n * Create directories recursively.\r\n * If they are already created, no problem.\r\n */\r\nfunction mkdir(folder) {\r\n    var folders = folder.split( '/' );\r\n    var dir = '.';\r\n    folders.forEach(function (folder) {\r\n        dir += '/' + folder;\r\n        if( !FS.existsSync( dir ) ) {\r\n            FS.mkdir( dir );\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction launch() {\r\n    FS.readFile(\"package.json\", function(err, out) {\r\n        if( err ) {\r\n            Err( err );\r\n            return;\r\n        }\r\n        try {\r\n            var jsn = out.toString();\r\n            var pkg = JSON.parse( out.toString() );\r\n            if( !checkForUpdates( pkg ) ) return;\r\n        } catch( ex ) {\r\n            Err(\"Bad JSON syntax in `package.json`!\");\r\n            return;\r\n        }\r\n        $('title').textContent = pkg.name + \" \" + pkg.version;\r\n        $('iframe').setAttribute( 'src', 'index.html' );\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * Two cases: first install or update.\r\n */\r\nfunction checkForUpdates( pkg ) {\r\n    if( !pkg.tfw || !pkg.tfw.app\r\n        || typeof pkg.tfw.app.id !== 'string' )\r\n    {\r\n        install( pkg );\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n\r\nfunction install( pkg ) {\r\n    if( typeof pkg.tfw === 'undefined' ) pkg.tfw = {};\r\n    if( typeof pkg.tfw.app === 'undefined' ) pkg.tfw.app = {};\r\n    var repo = new Text({\r\n        label: _('repository'), wide: false, width: '30rem',\r\n        value: 'http://localhost/Cameroun/index.php'\r\n    });\r\n    var loading = new Modal({ padding: true, content: [new Wait({ text: _('loading') })] });\r\n    var ok = Button.Ok();\r\n    var exit = new Button({ text: _('exit'), icon: \"close\", type: 'simple' });\r\n    exit.on(function() {\r\n        nw.Window.get().close();\r\n    });\r\n    var content = $.div([\r\n        repo, ok,\r\n        $.tag('hr'),\r\n        $.tag('center', [exit])\r\n    ]);\r\n    DB.bind( repo, 'action', ok, 'fire' );\r\n    var modal = new Modal({ padding: true, content: content });\r\n    modal.attach();\r\n    window.setTimeout(function() {\r\n        repo.focus = true;\r\n    }, 300);\r\n    ok.on(function() {\r\n        var url = repo.value.trim();\r\n        fetch( url ).then(function(response) {\r\n            console.info(\"[tolokoban-nw] response=\", response);\r\n            if( !response.ok ) {\r\n                Err(_('bad-repo') + \" - \" + response.status);\r\n                repo.focus = true;\r\n                return;\r\n            }\r\n            modal.detach();\r\n            Local.set('tolokoban-nw/repository', url);\r\n            return response.json();\r\n        }).then(function(list) {\r\n            console.info(\"[tolokoban-nw] list=\", list);\r\n            return fetch( url + '?' + list[0].id )\r\n        }).then(function(response) {\r\n            return response.json();\r\n        }).then(function(def) {\r\n            console.info(\"[tolokoban-nw] def=\", def);\r\n            loading.attach();\r\n            return download( def );\r\n        }).then(function() {\r\n            loading.detach();\r\n            location.reload();\r\n        }).catch(function(err) {\r\n            console.error( err );\r\n            repo.focus = true;\r\n            Err( \"<html>\" + _('bad-repo') + \"<br/>\" + err.message );\r\n        });\r\n    });\r\n}\r\n\r\n\r\nfunction download(def) {\r\n    // Check existence of download folder.\r\n    mkdir(\"tolokoban-nw/download\");\r\n\r\n    var downloadedFiles = [];\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            console.info(\"[tolokoban-nw] def=\", def);\r\n            if( def.files.length == 0 ) {\r\n                def.files = downloadedFiles;\r\n                Local.set('tolokoban-nw/install', def);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('download-progress', def.files.length);\r\n            var file = def.files.pop();\r\n            mkdir( 'tolokoban-nw/download/' + Path.dirname( file ) );\r\n            var url = def.url + file;\r\n            fetch( url ).then(function(response) {\r\n                if( !response.ok ) {\r\n                    throw Error(response.status + \" \" + response.statusText + \" - \" + url);\r\n                }\r\n                downloadedFiles.push( file );\r\n                return response.arrayBuffer();\r\n            }).then(function(arrayBuffer) {\r\n                var output = Path.resolve(Path.join(g_rootFolder, \"tolokoban-nw/download/\", file));\r\n                var data = new Buffer( arrayBuffer );\r\n                console.info(\"[tolokoban-nw] output=\", output);\r\n                console.info(\"[tolokoban-nw] arrayBuffer=\", arrayBuffer);\r\n                FS.writeFile( output, data, function( err ) {\r\n                    if( err ) throw Error(\"Unable to write file: \" + output + \"\\n\" + err);\r\n                    next();\r\n                });\r\n            }).catch( reject );\r\n        };\r\n\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n\r\nfunction upgrade( def ) {\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            if( def.files.length == 0 ) {\r\n                $('tooltip').textContent = '';\r\n                Local.set('tolokoban-nw/install', null);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('install-progress', def.files.length);\r\n            var file = def.files.pop();\r\n            mkdir( Path.dirname( file ) );\r\n            FS.readFile( \"./tolokoban-nw/download/\" + file, function(err, data) {\r\n                if( err ) {\r\n                    console.error( err );\r\n                    reject( err );\r\n                    return;\r\n                }\r\n                FS.writeFile( file, data, function( err ) {\r\n                    if( err ) {\r\n                        console.error( err );\r\n                        reject( err );\r\n                        return;\r\n                    }\r\n                    next();\r\n                });\r\n            });\r\n        };\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n  \r\nmodule.exports._ = _;\n/**\n * @module tolokoban-nw\n * @see module:$\n * @see module:dom\n * @see module:tfw.data-binding\n * @see module:tfw.message\n * @see module:wdg.text\n * @see module:wdg.wait\n * @see module:wdg.modal\n * @see module:tfw.storage\n * @see module:wdg.button\n\n */\n});","zip":"require(\"tolokoban-nw\",function(n,t,o){function e(n,t){return U.get(\"tolokoban-nw/\"+n,t)}function r(n,t){return U.set(\"tolokoban-nw/\"+n,t)}function i(){return new Promise(function(n,t){u().then(f).then(a)})}function a(){b(\"iframe\").setAttribute(\"src\",\"index.html\")}function s(){return new Promise(function(n,t){var o=e(\"repository\");if(o)return n(o);var r=new k({label:m(\"repository\"),wide:!1,width:\"30rem\",value:\"http://localhost/www/Cameroun/index.php\"}),i=(new $({padding:!0,content:[new y({text:m(\"loading\")})]}),P.Ok()),a=new P({text:m(\"exit\"),icon:\"close\",type:\"simple\"});a.on(d);var s=b.div([r,i,b.tag(\"hr\"),b.tag(\"center\",[a])]);v.bind(r,\"action\",i,\"fire\");var l=new $({padding:!0,content:s});l.attach(),window.setTimeout(function(){r.focus=!0},300),i.on(function(){n(r.value.trim())})})}function l(n){return new Promise(function(t,o){r(\"repository\",n);var i=e(\"id\");i&&t(n+\"?\"+i),fetch(n).then(function(n){if(!n.ok)throw{message:n.status+\": \"+n.statusText};return n.json()}).then(function(o){t({repo:n,id:o[0].id})}).catch(function(o){c(n,o).then(t)})})}function c(n,t){return new Promise(function(o,i){console.error(\"Unable to contact \",n,\" because of error \",t),e(\"version\")?o(null):$.alert(m(\"network-error\",n,t.message),function(){r(\"repository\",null),r(\"id\",null),r(\"version\",null),location.reload()})})}function u(){return new Promise(function(n,t){s().then(l).then(function(t){var o=t.repo+\"?\"+t.id;fetch(o).then(function(n){if(!n.ok)throw{message:n.status+\": \"+n.statusText};return n.json()}).then(function(t){n(t)}).catch(function(t){c(o,t).then(n)})})})}function f(n){h(\"tolokoban-nw/download\");var t=[];return new Promise(function(o,e){var r=function(){if(console.info(\"[tolokoban-nw] pkg=\",n),0==n.files.length)return n.files=t,U.set(\"tolokoban-nw/install666\",n),void o();b(\"tooltip\").textContent=m(\"download-progress\",n.files.length);var e=n.files.pop();h(\"tolokoban-nw/download/\"+j.dirname(e));var i=n.url+e;fetch(i).then(function(n){if(!n.ok)throw Error(n.status+\" \"+n.statusText+\" - \"+i);return t.push(e),n.arrayBuffer()}).then(function(n){var t=j.resolve(j.join(S,\"tolokoban-nw/download/\",e)),o=new Buffer(n);console.info(\"[tolokoban-nw] output=\",t),console.info(\"[tolokoban-nw] arrayBuffer=\",n),T.writeFile(t,o,function(n){if(n)throw Error(\"Unable to write file: \"+t+\"\\n\"+n);r()})}).catch(function(n){c(i,n).then(o)})};r()})}function d(){$.confirm(m(\"confirm-exit\"),function(){nw.Window.get().close()})}function p(){b(\"iframe\").setAttribute(\"src\",\"index.html\")}function w(n){return new Promise(function(n,t){alert(\"TODO!\")})}function h(n){var t=n.split(\"/\"),o=\".\";t.forEach(function(n){o+=\"/\"+n,T.existsSync(o)||T.mkdir(o)})}var g,m=function(){function t(){return e(o,arguments)}var o={en:{\"bad-repo\":\"Unable to contact this repository!\",\"confirm-exit\":\"Are you sure you want to exit this application?\",\"download-progress\":\"Downloading in progress: $1\",exit:\"Exit\",\"install-progress\":\"Installation in progress: $1\",loading:\"Downloading application files...\",\"network-error\":\"<html>An error occured while trying to contact repository <b>$1</b>.<pre class='error'>$2</pre><hr/>A good network connection is mandatory for the first installation.\",repository:\"Repository's URL\"},fr:{\"bad-repo\":\"Le dépôt spécifié ne répond pas !\",\"confirm-exit\":\"Êtes-vous sûr de vouloir quitter cette application ?\",\"download-progress\":\"Téléchargement en cours: $1\",exit:\"Quitter\",\"install-progress\":\"Installation en cours: $1\",loading:\"Téléchargement de l'application...\",\"network-error\":\"<html>Une erreur est survenur lors de la tentative de connexion au dépôt <b>$1</b>.<pre class='error'>$2</pre><hr/>Une bonne connexion réseau est indispensable lors de la première installation.\",repository:\"URL du dépôt\"}},e=n(\"$\").intl;return t.all=o,t}(),b=n(\"dom\"),v=n(\"tfw.data-binding\"),x=n(\"tfw.message\").error,k=n(\"wdg.text\"),y=n(\"wdg.wait\"),$=n(\"wdg.modal\"),U=n(\"tfw.storage\").local,P=n(\"wdg.button\"),T=n(\"node://fs\"),j=n(\"node://path\"),S=j.resolve(\".\");o.start=function(){$.alert(\"Start debugger now!\",function(){T.readFile(\"package.json\",function(n,t){if(n)return void x(\"<html>Unable to read/parse <b>package.json</b>: <code>\"+n.message+\"</code>\");try{t.toString();g=JSON.parse(t.toString())}catch(n){return void x(\"Bad JSON syntax in `package.json`!\")}b(\"title\").textContent=g.name+\" \"+g.version;var o=e(\"install\");o?w(o).then(p):i()})})},o.onExit=d,t.exports._=m});\n//# sourceMappingURL=tolokoban-nw.js.map","map":{"version":3,"file":"tolokoban-nw.js","sources":["tolokoban-nw.js"],"sourcesContent":["/** @module tolokoban-nw */require( 'tolokoban-nw', function(require, module, exports) { var _=function(){var D={\"en\":{\"bad-repo\":\"Unable to contact this repository!\",\"confirm-exit\":\"Are you sure you want to exit this application?\",\"download-progress\":\"Downloading in progress: $1\",\"exit\":\"Exit\",\"install-progress\":\"Installation in progress: $1\",\"loading\":\"Downloading application files...\",\"network-error\":\"<html>An error occured while trying to contact repository <b>$1</b>.<pre class='error'>$2</pre><hr/>A good network connection is mandatory for the first installation.\",\"repository\":\"Repository's URL\"},\"fr\":{\"bad-repo\":\"Le dépôt spécifié ne répond pas !\",\"confirm-exit\":\"Êtes-vous sûr de vouloir quitter cette application ?\",\"download-progress\":\"Téléchargement en cours: $1\",\"exit\":\"Quitter\",\"install-progress\":\"Installation en cours: $1\",\"loading\":\"Téléchargement de l'application...\",\"network-error\":\"<html>Une erreur est survenur lors de la tentative de connexion au dépôt <b>$1</b>.<pre class='error'>$2</pre><hr/>Une bonne connexion réseau est indispensable lors de la première installation.\",\"repository\":\"URL du dépôt\"}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n    /**\r\n * This is an application container.\r\n * It manages updates in background.\r\n */\r\n\r\n\"use strict\";\r\n\r\nvar $ = require(\"dom\");\r\nvar DB = require(\"tfw.data-binding\");\r\nvar Err = require(\"tfw.message\").error;\r\nvar Text = require(\"wdg.text\");\r\nvar Wait = require(\"wdg.wait\");\r\nvar Modal = require(\"wdg.modal\");\r\nvar Local = require(\"tfw.storage\").local;\r\nvar Button = require(\"wdg.button\");\r\n\r\nvar FS = require(\"node://fs\");\r\nvar Path = require(\"node://path\");\r\n\r\nvar g_rootFolder = Path.resolve('.');\r\nvar g_config;\r\n\r\nfunction get(key, def) {\r\n    return Local.get('tolokoban-nw' + '/' + key, def);\r\n}\r\n\r\nfunction set(key, val) {\r\n    return Local.set('tolokoban-nw' + '/' + key, val);\r\n}\r\n\r\n\r\nexports.start = function() {\r\n    Modal.alert(\"Start debugger now!\", function() {\r\n        FS.readFile(\"package.json\", function(err, out) {\r\n            if( err ) {\r\n                Err( \"<html>Unable to read/parse <b>package.json</b>: <code>\" + err.message + \"</code>\" );\r\n                return;\r\n            }\r\n            try {\r\n                var jsn = out.toString();\r\n                g_config = JSON.parse( out.toString() );\r\n            } catch( ex ) {\r\n                Err(\"Bad JSON syntax in `package.json`!\");\r\n                return;\r\n            }\r\n            $('title').textContent = g_config.name + \" \" + g_config.version;\r\n\r\n            var pkg = get( 'install' );\r\n            debugger;\r\n            if( pkg ) installPackage( pkg ).then( execApp );\r\n            else checkFirstLaunch();\r\n        });\r\n    });\r\n};\r\n\r\nexports.onExit = exitApp;\r\n\r\n/**\r\n * Check if it is the first launch or not.\r\n */\r\nfunction checkFirstLaunch() {\r\n    return new Promise(function (resolve, reject) {\r\n        getPackageDef().then( downloadPackageIfNeeded )\r\n        .then( showIndexPage );\r\n    });\r\n}\r\n\r\n/**\r\n * Open the page `index.html` in the IFrame.\r\n */\r\nfunction showIndexPage() {\r\n    $('iframe').setAttribute( 'src', 'index.html' );\r\n}\r\n\r\n/**\r\n * Promise which resolves in an URL of the repository.\r\n */\r\nfunction getRepositoryUrl() {\r\n    return new Promise(function (resolve, reject) {\r\n        var repository = get( 'repository' );\r\n        if( repository ) return resolve( repository );\r\n        var repo = new Text({\r\n            label: _('repository'), wide: false, width: '30rem',\r\n            value: 'http://localhost/www/Cameroun/index.php'\r\n        });\r\n        var loading = new Modal({ padding: true, content: [new Wait({ text: _('loading') })] });\r\n        var ok = Button.Ok();\r\n        var exit = new Button({ text: _('exit'), icon: \"close\", type: 'simple' });\r\n        exit.on( exitApp );\r\n        var content = $.div([\r\n            repo, ok,\r\n            $.tag('hr'),\r\n            $.tag('center', [exit])\r\n        ]);\r\n        DB.bind( repo, 'action', ok, 'fire' );\r\n        var modal = new Modal({ padding: true, content: content });\r\n        modal.attach();\r\n        window.setTimeout(function() {\r\n            repo.focus = true;\r\n        }, 300);\r\n        ok.on(function() {\r\n            resolve( repo.value.trim() );\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Resolves in the URL of the repo and the ID of the package.\r\n * `{ repo: <string>, id: <string> }`\r\n */\r\nfunction getPackageUrl( repoUrl ) {\r\n    return new Promise(function (resolve, reject) {\r\n        set( 'repository', repoUrl );\r\n        var pkgId = get( 'id' );\r\n        if( pkgId ) resolve( repoUrl + \"?\" + pkgId );\r\n        // Ask the repository the list of packages.\r\n        fetch( repoUrl ).then(function(response) {\r\n            if( !response.ok ) throw { message: response.status + \": \" + response.statusText };\r\n            return response.json();\r\n        }).then(function( packagesList ) {\r\n\r\n            // @TODO Manage the case of multi packages by adding a selection screen.\r\n            resolve({\r\n                repo: repoUrl,\r\n                id: packagesList[0].id\r\n            });\r\n        }).catch(function(err) {\r\n            manageNetworkFailure( repoUrl, err ).then( resolve );\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Network errors are ignored if the first installation has already occured.\r\n * That means if the `version` storage attribute has already been set.\r\n */\r\nfunction manageNetworkFailure( url, err ) {\r\n    return new Promise(function (resolve, reject) {\r\n        console.error( \"Unable to contact \", url, \" because of error \", err );\r\n        if( get('version') ) resolve( null );\r\n        else {\r\n            Modal.alert(_('network-error', url, err.message), function() {\r\n                set('repository', null);\r\n                set('id', null);\r\n                set('version', null);\r\n                location.reload();\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Resolves in a package definition or `null`.\r\n * A package definition has this format:\r\n * ```\r\n * {\r\n *   url: <string>\r\n *   version: <string>\r\n *   files: [<string>, ...]\r\n * }\r\n * ```\r\n */\r\nfunction getPackageDef() {\r\n    return new Promise(function (resolve, reject) {\r\n        getRepositoryUrl().then( getPackageUrl ).then(function( pkgUrl ) {\r\n            var url = pkgUrl.repo + \"?\" + pkgUrl.id;\r\n            fetch( url ).then(function( response ) {\r\n                if( !response.ok ) throw { message: response.status + \": \" + response.statusText };\r\n                return response.json();\r\n            }).then(function(pkgDef) {\r\n                resolve(pkgDef);\r\n            }).catch(function(err) {\r\n                manageNetworkFailure( url, err ).then( resolve );\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * If `get(\"version\")` is missing  or different from `pkg.version`, we\r\n * must download the package files.\r\n * It  `get(\"version\")` is  not  missing, the  downloads  will run  in\r\n * background. Otherwise, we will wait for all the downloads to finish\r\n * before resolving.\r\n */\r\nfunction downloadPackageIfNeeded( pkg ) {\r\n    // Check existence of download folder.\r\n    mkdir(\"tolokoban-nw/download\");\r\n\r\n    var downloadedFiles = [];\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            console.info(\"[tolokoban-nw] pkg=\", pkg);\r\n            if( pkg.files.length == 0 ) {\r\n                pkg.files = downloadedFiles;\r\n                // @TODO Mettre dans le bon parametre.\r\n                Local.set('tolokoban-nw/install666', pkg);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('download-progress', pkg.files.length);\r\n            var file = pkg.files.pop();\r\n            mkdir( 'tolokoban-nw/download/' + Path.dirname( file ) );\r\n            var url = pkg.url + file;\r\n            fetch( url ).then(function(response) {\r\n                if( !response.ok ) {\r\n                    throw Error(response.status + \" \" + response.statusText + \" - \" + url);\r\n                }\r\n                downloadedFiles.push( file );\r\n                return response.arrayBuffer();\r\n            }).then(function(arrayBuffer) {\r\n                var output = Path.resolve(Path.join(g_rootFolder, \"tolokoban-nw/download/\", file));\r\n                var data = new Buffer( arrayBuffer );\r\n                console.info(\"[tolokoban-nw] output=\", output);\r\n                console.info(\"[tolokoban-nw] arrayBuffer=\", arrayBuffer);\r\n                FS.writeFile( output, data, function( err ) {\r\n                    if( err ) throw Error(\"Unable to write file: \" + output + \"\\n\" + err);\r\n                    next();\r\n                });\r\n            }).catch(function(err) {\r\n                manageNetworkFailure( url, err ).then( resolve );\r\n            });\r\n        };\r\n\r\n        next();\r\n    });\r\n}\r\n\r\n/**\r\n * Close the mian window, hence exit the application.\r\n */\r\nfunction exitApp() {\r\n    Modal.confirm(_('confirm-exit'), function() {\r\n        nw.Window.get().close();\r\n    });\r\n}\r\n\r\n/**\r\n * Execute the application by loading `index.html` page.\r\n */\r\nfunction execApp() {\r\n    $('iframe').setAttribute( 'src', 'index.html' );\r\n}\r\n\r\n/**\r\n * Install package stored in `/tolokoban-nw/package`.\r\n */\r\nfunction installPackage( pkg ) {\r\n    return new Promise(function (resolve, reject) {\r\n        alert('TODO!');\r\n    });\r\n}\r\n\r\n/**\r\n * Create directories recursively.\r\n * If they are already created, no problem.\r\n */\r\nfunction mkdir(folder) {\r\n    var folders = folder.split( '/' );\r\n    var dir = '.';\r\n    folders.forEach(function (folder) {\r\n        dir += '/' + folder;\r\n        if( !FS.existsSync( dir ) ) {\r\n            FS.mkdir( dir );\r\n        }\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction launch() {\r\n    FS.readFile(\"package.json\", function(err, out) {\r\n        if( err ) {\r\n            Err( err );\r\n            return;\r\n        }\r\n        try {\r\n            var jsn = out.toString();\r\n            var pkg = JSON.parse( out.toString() );\r\n            if( !checkForUpdates( pkg ) ) return;\r\n        } catch( ex ) {\r\n            Err(\"Bad JSON syntax in `package.json`!\");\r\n            return;\r\n        }\r\n        $('title').textContent = pkg.name + \" \" + pkg.version;\r\n        $('iframe').setAttribute( 'src', 'index.html' );\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * Two cases: first install or update.\r\n */\r\nfunction checkForUpdates( pkg ) {\r\n    if( !pkg.tfw || !pkg.tfw.app\r\n        || typeof pkg.tfw.app.id !== 'string' )\r\n    {\r\n        install( pkg );\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n\r\nfunction install( pkg ) {\r\n    if( typeof pkg.tfw === 'undefined' ) pkg.tfw = {};\r\n    if( typeof pkg.tfw.app === 'undefined' ) pkg.tfw.app = {};\r\n    var repo = new Text({\r\n        label: _('repository'), wide: false, width: '30rem',\r\n        value: 'http://localhost/Cameroun/index.php'\r\n    });\r\n    var loading = new Modal({ padding: true, content: [new Wait({ text: _('loading') })] });\r\n    var ok = Button.Ok();\r\n    var exit = new Button({ text: _('exit'), icon: \"close\", type: 'simple' });\r\n    exit.on(function() {\r\n        nw.Window.get().close();\r\n    });\r\n    var content = $.div([\r\n        repo, ok,\r\n        $.tag('hr'),\r\n        $.tag('center', [exit])\r\n    ]);\r\n    DB.bind( repo, 'action', ok, 'fire' );\r\n    var modal = new Modal({ padding: true, content: content });\r\n    modal.attach();\r\n    window.setTimeout(function() {\r\n        repo.focus = true;\r\n    }, 300);\r\n    ok.on(function() {\r\n        var url = repo.value.trim();\r\n        fetch( url ).then(function(response) {\r\n            console.info(\"[tolokoban-nw] response=\", response);\r\n            if( !response.ok ) {\r\n                Err(_('bad-repo') + \" - \" + response.status);\r\n                repo.focus = true;\r\n                return;\r\n            }\r\n            modal.detach();\r\n            Local.set('tolokoban-nw/repository', url);\r\n            return response.json();\r\n        }).then(function(list) {\r\n            console.info(\"[tolokoban-nw] list=\", list);\r\n            return fetch( url + '?' + list[0].id )\r\n        }).then(function(response) {\r\n            return response.json();\r\n        }).then(function(def) {\r\n            console.info(\"[tolokoban-nw] def=\", def);\r\n            loading.attach();\r\n            return download( def );\r\n        }).then(function() {\r\n            loading.detach();\r\n            location.reload();\r\n        }).catch(function(err) {\r\n            console.error( err );\r\n            repo.focus = true;\r\n            Err( \"<html>\" + _('bad-repo') + \"<br/>\" + err.message );\r\n        });\r\n    });\r\n}\r\n\r\n\r\nfunction download(def) {\r\n    // Check existence of download folder.\r\n    mkdir(\"tolokoban-nw/download\");\r\n\r\n    var downloadedFiles = [];\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            console.info(\"[tolokoban-nw] def=\", def);\r\n            if( def.files.length == 0 ) {\r\n                def.files = downloadedFiles;\r\n                Local.set('tolokoban-nw/install', def);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('download-progress', def.files.length);\r\n            var file = def.files.pop();\r\n            mkdir( 'tolokoban-nw/download/' + Path.dirname( file ) );\r\n            var url = def.url + file;\r\n            fetch( url ).then(function(response) {\r\n                if( !response.ok ) {\r\n                    throw Error(response.status + \" \" + response.statusText + \" - \" + url);\r\n                }\r\n                downloadedFiles.push( file );\r\n                return response.arrayBuffer();\r\n            }).then(function(arrayBuffer) {\r\n                var output = Path.resolve(Path.join(g_rootFolder, \"tolokoban-nw/download/\", file));\r\n                var data = new Buffer( arrayBuffer );\r\n                console.info(\"[tolokoban-nw] output=\", output);\r\n                console.info(\"[tolokoban-nw] arrayBuffer=\", arrayBuffer);\r\n                FS.writeFile( output, data, function( err ) {\r\n                    if( err ) throw Error(\"Unable to write file: \" + output + \"\\n\" + err);\r\n                    next();\r\n                });\r\n            }).catch( reject );\r\n        };\r\n\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n\r\nfunction upgrade( def ) {\r\n    return new Promise(function (resolve, reject) {\r\n        var next = function() {\r\n            if( def.files.length == 0 ) {\r\n                $('tooltip').textContent = '';\r\n                Local.set('tolokoban-nw/install', null);\r\n                resolve();\r\n                return;\r\n            }\r\n            $('tooltip').textContent = _('install-progress', def.files.length);\r\n            var file = def.files.pop();\r\n            mkdir( Path.dirname( file ) );\r\n            FS.readFile( \"./tolokoban-nw/download/\" + file, function(err, data) {\r\n                if( err ) {\r\n                    console.error( err );\r\n                    reject( err );\r\n                    return;\r\n                }\r\n                FS.writeFile( file, data, function( err ) {\r\n                    if( err ) {\r\n                        console.error( err );\r\n                        reject( err );\r\n                        return;\r\n                    }\r\n                    next();\r\n                });\r\n            });\r\n        };\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n  \r\nmodule.exports._ = _;\n});"],"names":["require","module","exports","get","key","def","Local","set","val","checkFirstLaunch","Promise","resolve","reject","getPackageDef","then","downloadPackageIfNeeded","showIndexPage","$","setAttribute","getRepositoryUrl","repository","repo","Text","label","_","wide","width","value","ok","Modal","padding","content","Wait","text","Button","Ok","exit","icon","type","on","exitApp","div","tag","DB","bind","modal","attach","window","setTimeout","focus","trim","getPackageUrl","repoUrl","pkgId","fetch","response","message","status","statusText","json","packagesList","id","catch","err","manageNetworkFailure","url","console","error","alert","location","reload","pkgUrl","pkgDef","pkg","mkdir","downloadedFiles","next","info","files","length","textContent","file","pop","Path","dirname","Error","push","arrayBuffer","output","join","g_rootFolder","data","Buffer","FS","writeFile","confirm","nw","Window","close","execApp","installPackage","folder","folders","split","dir","forEach","existsSync","g_config","X","D","arguments","en","bad-repo","confirm-exit","download-progress","install-progress","loading","network-error","fr","intl","all","Err","local","start","readFile","out","toString","JSON","parse","ex","name","version","onExit"],"mappings":"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"},"dependencies":["mod/$","mod/dom","mod/tfw.data-binding","mod/tfw.message","mod/wdg.text","mod/wdg.wait","mod/wdg.modal","mod/tfw.storage","mod/wdg.button"]}