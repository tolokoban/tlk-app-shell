{"intl":"var _=function(){var D={\"en\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n","src":"/** @module wdg.text */require( 'wdg.text', function(require, module, exports) { var _=function(){var D={\"en\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n    var $ = require(\"dom\");\r\nvar DB = require(\"tfw.data-binding\");\r\nvar Lang = require(\"wdg.lang\");\r\nvar LaterAction = require(\"tfw.timer\").laterAction;\r\n\r\n/**\r\n * @class Text\r\n * @description  HTML5 text input with many options.\r\n *\r\n * @param opts.value {string} - .\r\n * @param opts.type {string} - One of the following strings: 'text', 'button', 'checkbox', 'color', 'date', 'datetime', 'email', 'file', 'hidden', 'image', 'month', 'password', 'radio', 'range', 'reset', 'number', 'search', 'submit', 'tel', 'time', 'url', 'week'.\r\n * @param opts.placeholder {string} - .\r\n * @param opts.enabled {boolean} - .\r\n * @param opts.validator {} - .\r\n * @param opts.valid {} - .\r\n * @param opts.list {} - .\r\n * @param opts.label {string} - .\r\n * @param opts.placeholder {string} - .\r\n * @param opts.size {} - .\r\n * @param opts.width {} - .\r\n * @param opts.focus {} - .\r\n * @param opts.wide {boolean} - .\r\n * @param opts.visible {boolean} - .\r\n */\r\nvar Text = function(opts) {\r\n    var that = this;\r\n\r\n    var dataListHasFocus = false;\r\n    var autocompleteProposals = [];\r\n    var autocompleteShift = 0;\r\n\r\n    var label = $.div( 'theme-label', 'theme-color-bg-1' );\r\n    var input = $.tag( 'input' );\r\n    var lang = new Lang({ small: true, visible: true });\r\n    var body = $.div('nowrap', [input, lang]);\r\n    var datalist = $.div( 'datalist', 'theme-elevation-12' );\r\n    this._input = input;\r\n    var elem = $.elem( this, 'div', 'wdg-text', 'theme-elevation-2', [label, body, datalist] );\r\n\r\n    DB.bind( lang, 'value', function(v) {\r\n        input.value = that.value[v] || '';\r\n        input.focus();\r\n    });\r\n\r\n    DB.prop(this, 'value')(function(v) {\r\n        if( v === null || typeof v === 'undefined') v = '';\r\n        if( typeof v === 'number' || typeof v === 'boolean') v = '' + v;\r\n        if( typeof v !== 'string' ) {\r\n            input.value = v[lang.value];\r\n            var subset = [];\r\n            var isoLang;\r\n            for( isoLang in v ) {\r\n                subset.push( isoLang );\r\n            }\r\n            lang.subset = subset;\r\n            that.intl = true;\r\n        } else {\r\n            input.value = v;\r\n            that.intl = false;\r\n        }\r\n        that.validate();\r\n    });\r\n    DB.propBoolean(this, 'intl')(function(v) {\r\n        lang.visible = v;\r\n    });\r\n    DB.propEnum(['text', 'button', 'checkbox', 'color', 'date', 'datetime', 'email', 'file',\r\n                 'hidden', 'image', 'month', 'password', 'radio', 'range', 'reset',\r\n                 'search', 'submit', 'tel', 'time', 'url', 'week'])(this, 'type')\r\n    (function(v) {\r\n        $.att(input, {type: v});\r\n    });\r\n    DB.propStringArray(this, 'list')(function(v) {\r\nconsole.info(\"[wdg.text] v=...\", v);\r\n        $.clear( datalist );\r\n        $.removeClass( elem, \"list\" );\r\n        if (!Array.isArray( v )) return;\r\n        v.forEach(function ( item ) {\r\n            $.add( datalist, $.div( [item] ) );\r\n        });\r\n        if( v.length > 0 ) {\r\n            $.att( elem, \"list\" );\r\n        }\r\n    });\r\n    DB.propValidator(this, 'validator')(this.validate.bind( this ));\r\n    DB.propBoolean(this, 'valid')(function(v) {\r\n        if (v === null || !that.validator) {\r\n            $.removeClass( elem, \"valid\", \"no-valid\" );\r\n        } else {\r\n            if (v) {\r\n                $.addClass( elem, \"valid\" );\r\n                $.removeClass( elem, \"no-valid\" );\r\n            } else {\r\n                $.removeClass( elem, \"valid\" );\r\n                $.addClass( elem, \"no-valid\" );\r\n            }\r\n        }\r\n    });\r\n    DB.propBoolean(this, 'enabled')(function(v) {\r\n        if (v) {\r\n            $.removeAtt(input, 'disabled');\r\n        } else {\r\n            $.att(input, {disabled: v});\r\n        }\r\n    });\r\n    DB.propInteger(this, 'size')(function(v) {\r\n        if (v < 1) {\r\n            $.removeAtt(input, 'size');\r\n        } else {\r\n            $.att(input, {size: v});\r\n        }\r\n    });\r\n    DB.propString(this, 'label')(function(v) {\r\n        if (v === null || (typeof v === 'string' && v.trim() == '')) {\r\n            $.addClass(elem, 'no-label');\r\n        } else {\r\n            $.removeClass(elem, 'no-label');\r\n            $.textOrHtml(label, v);\r\n            if (v.substr(0, 6) == '<html>') {\r\n                $.att(label, {title: ''});\r\n            } else {\r\n                $.att(label, {title: v});\r\n            }\r\n        }\r\n    });\r\n    DB.propString(this, 'placeholder')(function(v) {\r\n        $.att(input, {placeholder: v});\r\n    });\r\n    DB.propString(this, 'width')(function(v) {\r\n        elem.style.width = v;\r\n    });\r\n    DB.propBoolean(this, 'focus')(function(v) {\r\n        if (v) input.focus();\r\n        else input.blur();\r\n    });\r\n    DB.propInteger(this, 'action', '');\r\n    DB.propAddClass(this, 'wide');\r\n    DB.propRemoveClass(this, 'visible', 'hide');\r\n\r\n    opts = DB.extend({\r\n        intl: false,\r\n        value: '',\r\n        type: 'text',\r\n        placeholder: '',\r\n        enabled: true,\r\n        validator: null,\r\n        valid: true,\r\n        list: null,\r\n        label: '',\r\n        placeholder: '',\r\n        size: 10,\r\n        width: 'auto',\r\n        focus: false,\r\n        wide: false,\r\n        visible: true\r\n    }, opts, this);\r\n\r\nconsole.info(\"[wdg.text] that.list=...\", that.list);\r\n\r\n    var complete = function() {\r\n        $.removeClass( elem, \"list\" );\r\n        if (!that.list || that.list.length == 0) return;\r\nconsole.info(\"[wdg.text] that.list=...\", that.list);\r\n\r\n        $.clear( datalist );\r\n        var list = that.list.map(String.toLowerCase);\r\n        var needle = input.value.trim().toLowerCase();\r\n\r\n        if (needle.length > 0) {\r\n            list = list.map(function(itm, idx) {\r\n                return [idx, itm.indexOf( needle )];\r\n            }).filter(function(itm) {\r\n                return itm[1] > -1;\r\n            }).sort(function(a, b) {\r\n                var d = a[1] - b[1];\r\n                if (d != 0) return d;\r\n                var sa = that.list[a[0]];\r\n                var sb = that.list[b[0]];\r\n                if (sa < sb) return -1;\r\n                if (sa > sb) return 1;\r\n                return 0;\r\n            }).map(function(itm) {\r\n                var t = that.list[itm[0]];\r\n                var i = itm[1];\r\n                return t.substr(0, i)\r\n                    + \"<b>\" + t.substr(i, needle.length) + \"</b>\"\r\n                    + t.substr(i + needle.length);\r\n            });\r\n        } else {\r\n            list = list.sort();\r\n        }\r\n        if (autocompleteShift > 0) {\r\n            // Put the current item to the top of the list.\r\n            // Use arrow keys to change `autocompleteShift`.\r\n            list = list.slice( autocompleteShift ).concat( list.slice( 0, autocompleteShift ) );\r\n        }\r\n        autocompleteProposals = list;\r\n\r\n        list.forEach(function (item, idx) {\r\n            var div = $.div();\r\n            div.innerHTML = item;\r\n            list[idx] = div.textContent.trim();\r\n            $.add( datalist, div );\r\n            $.on( div, {\r\n                down: function() {\r\n                    dataListHasFocus = true;\r\n                },\r\n                up: function() {\r\n                    dataListHasFocus = false;\r\n                    that.focus = true;\r\n                },\r\n                tap: function() {\r\n                    that.value = div.textContent.trim();\r\n                    console.info(\"[wdg.text] div=...\", div);\r\n                    $.removeClass( elem, 'list' );\r\n                }\r\n            });\r\n        });\r\n        if (list.length > 0) {\r\n            $.addClass( elem, \"list\" );\r\n        } else {\r\n            $.removeClass( elem, \"list\" );\r\n        }\r\n    };\r\n\r\n    var actionUpdateValue = LaterAction(function() {\r\n        if( !that.intl ) {\r\n            that.value = input.value;\r\n        } else {\r\n            that.value[lang.value] = input.value;\r\n            DB.fire( that, 'value', that.value );\r\n        }\r\n    }, 300);\r\n    input.addEventListener('keyup', function(evt) {\r\n        if (evt.keyCode == 13) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n            if ($.hasClass( elem, 'list' )) {\r\n                $.removeClass( elem, 'list' );\r\n                that.value = autocompleteProposals[0];\r\n            }\r\n            else if (that.valid !== false) {\r\n                DB.fire( that, 'value', input.value );\r\n                DB.fire( that, 'action', input.value );\r\n            }\r\n        }\r\n        else if (evt.keyCode == 27) {\r\n            $.removeClass( elem, \"list\" );\r\n            autocompleteShift = 0;\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else if (evt.keyCode == 40 && $.hasClass( elem, 'list' )) {\r\n            autocompleteShift = (autocompleteShift + 1) % autocompleteProposals.length;\r\n            complete();\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else if (evt.keyCode == 38 && $.hasClass( elem, 'list' )) {\r\n            autocompleteShift = (autocompleteShift + autocompleteProposals.length - 1)\r\n                % autocompleteProposals.length;\r\n            complete();\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else {\r\n            autocompleteShift = 0;\r\n            complete();\r\n            actionUpdateValue.fire();\r\n        }\r\n    });\r\n    input.addEventListener('blur', function() {\r\n        if( !that.intl ) {\r\n            that.value = input.value;\r\n        } else {\r\n            that.value[lang.value] = input.value;\r\n            DB.fire( that, 'value', that.value );\r\n        }\r\n        if (!dataListHasFocus) {\r\n            $.removeClass( elem, \"list\" );\r\n        }\r\n        $.addClass( elem, \"theme-elevation-2\" );\r\n        $.removeClass( elem, \"theme-elevation-8\" );\r\n        $.removeClass(input, 'theme-color-bg-A1');\r\n        that.focus = false;\r\n    });\r\n    input.addEventListener('focus', function() {\r\n        that.selectAll();\r\n        $.removeClass( elem, \"theme-elevation-2\" );\r\n        $.addClass( elem, \"theme-elevation-8\" );\r\n        $.addClass(input, 'theme-color-bg-A1');\r\n        that.focus = true;\r\n    });\r\n    input.addEventListener('keydown', function(evt) {\r\n    });\r\n\r\n    this.validate();\r\n};\r\n\r\n\r\n/**\r\n * Force value validation.\r\n */\r\nText.prototype.validate = function() {\r\n    var validator = this.validator;\r\n    if (!validator) return;\r\n    try {\r\n        this.valid = validator( this.value );\r\n    }\r\n    catch (ex) {\r\n        console.error(\"[wdg.text:validate] Exception = \", ex);\r\n        console.error(\"[wdg.text:validate] Validator = \", validator);\r\n    }\r\n};\r\n\r\n/**\r\n * Select whole text.\r\n * @return {this}\r\n */\r\nText.prototype.selectAll = function() {\r\n    var e = this._input;\r\n    e.setSelectionRange(0, e.value.length);\r\n    return true;\r\n};\r\n\r\nmodule.exports = Text;\r\n\r\n\r\n  \r\nmodule.exports._ = _;\n/**\n * @module wdg.text\n * @see module:$\n * @see module:dom\n * @see module:tfw.data-binding\n * @see module:wdg.lang\n * @see module:tfw.timer\n\n */\n});","zip":"require(\"wdg.text\",function(t,e,l){var i=function(){function e(){return i(l,arguments)}var l={en:{}},i=t(\"$\").intl;return e.all=l,e}(),a=t(\"dom\"),n=t(\"tfw.data-binding\"),o=t(\"wdg.lang\"),s=t(\"tfw.timer\").laterAction,r=function(t){var e=this,l=!1,i=[],r=0,u=a.div(\"theme-label\",\"theme-color-bg-1\"),v=a.tag(\"input\"),d=new o({small:!0,visible:!0}),c=a.div(\"nowrap\",[v,d]),p=a.div(\"datalist\",\"theme-elevation-12\");this._input=v;var f=a.elem(this,\"div\",\"wdg-text\",\"theme-elevation-2\",[u,c,p]);n.bind(d,\"value\",function(t){v.value=e.value[t]||\"\",v.focus()}),n.prop(this,\"value\")(function(t){if(null!==t&&\"undefined\"!=typeof t||(t=\"\"),\"number\"!=typeof t&&\"boolean\"!=typeof t||(t=\"\"+t),\"string\"!=typeof t){v.value=t[d.value];var l,i=[];for(l in t)i.push(l);d.subset=i,e.intl=!0}else v.value=t,e.intl=!1;e.validate()}),n.propBoolean(this,\"intl\")(function(t){d.visible=t}),n.propEnum([\"text\",\"button\",\"checkbox\",\"color\",\"date\",\"datetime\",\"email\",\"file\",\"hidden\",\"image\",\"month\",\"password\",\"radio\",\"range\",\"reset\",\"search\",\"submit\",\"tel\",\"time\",\"url\",\"week\"])(this,\"type\")(function(t){a.att(v,{type:t})}),n.propStringArray(this,\"list\")(function(t){console.info(\"[wdg.text] v=...\",t),a.clear(p),a.removeClass(f,\"list\"),Array.isArray(t)&&(t.forEach(function(t){a.add(p,a.div([t]))}),t.length>0&&a.att(f,\"list\"))}),n.propValidator(this,\"validator\")(this.validate.bind(this)),n.propBoolean(this,\"valid\")(function(t){null!==t&&e.validator?t?(a.addClass(f,\"valid\"),a.removeClass(f,\"no-valid\")):(a.removeClass(f,\"valid\"),a.addClass(f,\"no-valid\")):a.removeClass(f,\"valid\",\"no-valid\")}),n.propBoolean(this,\"enabled\")(function(t){t?a.removeAtt(v,\"disabled\"):a.att(v,{disabled:t})}),n.propInteger(this,\"size\")(function(t){t<1?a.removeAtt(v,\"size\"):a.att(v,{size:t})}),n.propString(this,\"label\")(function(t){null===t||\"string\"==typeof t&&\"\"==t.trim()?a.addClass(f,\"no-label\"):(a.removeClass(f,\"no-label\"),a.textOrHtml(u,t),\"<html>\"==t.substr(0,6)?a.att(u,{title:\"\"}):a.att(u,{title:t}))}),n.propString(this,\"placeholder\")(function(t){a.att(v,{placeholder:t})}),n.propString(this,\"width\")(function(t){f.style.width=t}),n.propBoolean(this,\"focus\")(function(t){t?v.focus():v.blur()}),n.propInteger(this,\"action\",\"\"),n.propAddClass(this,\"wide\"),n.propRemoveClass(this,\"visible\",\"hide\"),t=n.extend({intl:!1,value:\"\",type:\"text\",placeholder:\"\",enabled:!0,validator:null,valid:!0,list:null,label:\"\",placeholder:\"\",size:10,width:\"auto\",focus:!1,wide:!1,visible:!0},t,this),console.info(\"[wdg.text] that.list=...\",e.list);var h=function(){if(a.removeClass(f,\"list\"),e.list&&0!=e.list.length){console.info(\"[wdg.text] that.list=...\",e.list),a.clear(p);var t=e.list.map(String.toLowerCase),n=v.value.trim().toLowerCase();t=n.length>0?t.map(function(t,e){return[e,t.indexOf(n)]}).filter(function(t){return t[1]>-1}).sort(function(t,l){var i=t[1]-l[1];if(0!=i)return i;var a=e.list[t[0]],n=e.list[l[0]];return a<n?-1:a>n?1:0}).map(function(t){var l=e.list[t[0]],i=t[1];return l.substr(0,i)+\"<b>\"+l.substr(i,n.length)+\"</b>\"+l.substr(i+n.length)}):t.sort(),r>0&&(t=t.slice(r).concat(t.slice(0,r))),i=t,t.forEach(function(i,n){var o=a.div();o.innerHTML=i,t[n]=o.textContent.trim(),a.add(p,o),a.on(o,{down:function(){l=!0},up:function(){l=!1,e.focus=!0},tap:function(){e.value=o.textContent.trim(),console.info(\"[wdg.text] div=...\",o),a.removeClass(f,\"list\")}})}),t.length>0?a.addClass(f,\"list\"):a.removeClass(f,\"list\")}},m=s(function(){e.intl?(e.value[d.value]=v.value,n.fire(e,\"value\",e.value)):e.value=v.value},300);v.addEventListener(\"keyup\",function(t){13==t.keyCode?(t.preventDefault(),t.stopPropagation(),a.hasClass(f,\"list\")?(a.removeClass(f,\"list\"),e.value=i[0]):e.valid!==!1&&(n.fire(e,\"value\",v.value),n.fire(e,\"action\",v.value))):27==t.keyCode?(a.removeClass(f,\"list\"),r=0,t.preventDefault(),t.stopPropagation()):40==t.keyCode&&a.hasClass(f,\"list\")?(r=(r+1)%i.length,h(),t.preventDefault(),t.stopPropagation()):38==t.keyCode&&a.hasClass(f,\"list\")?(r=(r+i.length-1)%i.length,h(),t.preventDefault(),t.stopPropagation()):(r=0,h(),m.fire())}),v.addEventListener(\"blur\",function(){e.intl?(e.value[d.value]=v.value,n.fire(e,\"value\",e.value)):e.value=v.value,l||a.removeClass(f,\"list\"),a.addClass(f,\"theme-elevation-2\"),a.removeClass(f,\"theme-elevation-8\"),a.removeClass(v,\"theme-color-bg-A1\"),e.focus=!1}),v.addEventListener(\"focus\",function(){e.selectAll(),a.removeClass(f,\"theme-elevation-2\"),a.addClass(f,\"theme-elevation-8\"),a.addClass(v,\"theme-color-bg-A1\"),e.focus=!0}),v.addEventListener(\"keydown\",function(t){}),this.validate()};r.prototype.validate=function(){var t=this.validator;if(t)try{this.valid=t(this.value)}catch(e){console.error(\"[wdg.text:validate] Exception = \",e),console.error(\"[wdg.text:validate] Validator = \",t)}},r.prototype.selectAll=function(){var t=this._input;return t.setSelectionRange(0,t.value.length),!0},e.exports=r,e.exports._=i});\n//# sourceMappingURL=wdg.text.js.map","map":{"version":3,"file":"wdg.text.js","sources":["wdg.text.js"],"sourcesContent":["/** @module wdg.text */require( 'wdg.text', function(require, module, exports) { var _=function(){var D={\"en\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n    var $ = require(\"dom\");\r\nvar DB = require(\"tfw.data-binding\");\r\nvar Lang = require(\"wdg.lang\");\r\nvar LaterAction = require(\"tfw.timer\").laterAction;\r\n\r\n/**\r\n * @class Text\r\n * @description  HTML5 text input with many options.\r\n *\r\n * @param opts.value {string} - .\r\n * @param opts.type {string} - One of the following strings: 'text', 'button', 'checkbox', 'color', 'date', 'datetime', 'email', 'file', 'hidden', 'image', 'month', 'password', 'radio', 'range', 'reset', 'number', 'search', 'submit', 'tel', 'time', 'url', 'week'.\r\n * @param opts.placeholder {string} - .\r\n * @param opts.enabled {boolean} - .\r\n * @param opts.validator {} - .\r\n * @param opts.valid {} - .\r\n * @param opts.list {} - .\r\n * @param opts.label {string} - .\r\n * @param opts.placeholder {string} - .\r\n * @param opts.size {} - .\r\n * @param opts.width {} - .\r\n * @param opts.focus {} - .\r\n * @param opts.wide {boolean} - .\r\n * @param opts.visible {boolean} - .\r\n */\r\nvar Text = function(opts) {\r\n    var that = this;\r\n\r\n    var dataListHasFocus = false;\r\n    var autocompleteProposals = [];\r\n    var autocompleteShift = 0;\r\n\r\n    var label = $.div( 'theme-label', 'theme-color-bg-1' );\r\n    var input = $.tag( 'input' );\r\n    var lang = new Lang({ small: true, visible: true });\r\n    var body = $.div('nowrap', [input, lang]);\r\n    var datalist = $.div( 'datalist', 'theme-elevation-12' );\r\n    this._input = input;\r\n    var elem = $.elem( this, 'div', 'wdg-text', 'theme-elevation-2', [label, body, datalist] );\r\n\r\n    DB.bind( lang, 'value', function(v) {\r\n        input.value = that.value[v] || '';\r\n        input.focus();\r\n    });\r\n\r\n    DB.prop(this, 'value')(function(v) {\r\n        if( v === null || typeof v === 'undefined') v = '';\r\n        if( typeof v === 'number' || typeof v === 'boolean') v = '' + v;\r\n        if( typeof v !== 'string' ) {\r\n            input.value = v[lang.value];\r\n            var subset = [];\r\n            var isoLang;\r\n            for( isoLang in v ) {\r\n                subset.push( isoLang );\r\n            }\r\n            lang.subset = subset;\r\n            that.intl = true;\r\n        } else {\r\n            input.value = v;\r\n            that.intl = false;\r\n        }\r\n        that.validate();\r\n    });\r\n    DB.propBoolean(this, 'intl')(function(v) {\r\n        lang.visible = v;\r\n    });\r\n    DB.propEnum(['text', 'button', 'checkbox', 'color', 'date', 'datetime', 'email', 'file',\r\n                 'hidden', 'image', 'month', 'password', 'radio', 'range', 'reset',\r\n                 'search', 'submit', 'tel', 'time', 'url', 'week'])(this, 'type')\r\n    (function(v) {\r\n        $.att(input, {type: v});\r\n    });\r\n    DB.propStringArray(this, 'list')(function(v) {\r\nconsole.info(\"[wdg.text] v=...\", v);\r\n        $.clear( datalist );\r\n        $.removeClass( elem, \"list\" );\r\n        if (!Array.isArray( v )) return;\r\n        v.forEach(function ( item ) {\r\n            $.add( datalist, $.div( [item] ) );\r\n        });\r\n        if( v.length > 0 ) {\r\n            $.att( elem, \"list\" );\r\n        }\r\n    });\r\n    DB.propValidator(this, 'validator')(this.validate.bind( this ));\r\n    DB.propBoolean(this, 'valid')(function(v) {\r\n        if (v === null || !that.validator) {\r\n            $.removeClass( elem, \"valid\", \"no-valid\" );\r\n        } else {\r\n            if (v) {\r\n                $.addClass( elem, \"valid\" );\r\n                $.removeClass( elem, \"no-valid\" );\r\n            } else {\r\n                $.removeClass( elem, \"valid\" );\r\n                $.addClass( elem, \"no-valid\" );\r\n            }\r\n        }\r\n    });\r\n    DB.propBoolean(this, 'enabled')(function(v) {\r\n        if (v) {\r\n            $.removeAtt(input, 'disabled');\r\n        } else {\r\n            $.att(input, {disabled: v});\r\n        }\r\n    });\r\n    DB.propInteger(this, 'size')(function(v) {\r\n        if (v < 1) {\r\n            $.removeAtt(input, 'size');\r\n        } else {\r\n            $.att(input, {size: v});\r\n        }\r\n    });\r\n    DB.propString(this, 'label')(function(v) {\r\n        if (v === null || (typeof v === 'string' && v.trim() == '')) {\r\n            $.addClass(elem, 'no-label');\r\n        } else {\r\n            $.removeClass(elem, 'no-label');\r\n            $.textOrHtml(label, v);\r\n            if (v.substr(0, 6) == '<html>') {\r\n                $.att(label, {title: ''});\r\n            } else {\r\n                $.att(label, {title: v});\r\n            }\r\n        }\r\n    });\r\n    DB.propString(this, 'placeholder')(function(v) {\r\n        $.att(input, {placeholder: v});\r\n    });\r\n    DB.propString(this, 'width')(function(v) {\r\n        elem.style.width = v;\r\n    });\r\n    DB.propBoolean(this, 'focus')(function(v) {\r\n        if (v) input.focus();\r\n        else input.blur();\r\n    });\r\n    DB.propInteger(this, 'action', '');\r\n    DB.propAddClass(this, 'wide');\r\n    DB.propRemoveClass(this, 'visible', 'hide');\r\n\r\n    opts = DB.extend({\r\n        intl: false,\r\n        value: '',\r\n        type: 'text',\r\n        placeholder: '',\r\n        enabled: true,\r\n        validator: null,\r\n        valid: true,\r\n        list: null,\r\n        label: '',\r\n        placeholder: '',\r\n        size: 10,\r\n        width: 'auto',\r\n        focus: false,\r\n        wide: false,\r\n        visible: true\r\n    }, opts, this);\r\n\r\nconsole.info(\"[wdg.text] that.list=...\", that.list);\r\n\r\n    var complete = function() {\r\n        $.removeClass( elem, \"list\" );\r\n        if (!that.list || that.list.length == 0) return;\r\nconsole.info(\"[wdg.text] that.list=...\", that.list);\r\n\r\n        $.clear( datalist );\r\n        var list = that.list.map(String.toLowerCase);\r\n        var needle = input.value.trim().toLowerCase();\r\n\r\n        if (needle.length > 0) {\r\n            list = list.map(function(itm, idx) {\r\n                return [idx, itm.indexOf( needle )];\r\n            }).filter(function(itm) {\r\n                return itm[1] > -1;\r\n            }).sort(function(a, b) {\r\n                var d = a[1] - b[1];\r\n                if (d != 0) return d;\r\n                var sa = that.list[a[0]];\r\n                var sb = that.list[b[0]];\r\n                if (sa < sb) return -1;\r\n                if (sa > sb) return 1;\r\n                return 0;\r\n            }).map(function(itm) {\r\n                var t = that.list[itm[0]];\r\n                var i = itm[1];\r\n                return t.substr(0, i)\r\n                    + \"<b>\" + t.substr(i, needle.length) + \"</b>\"\r\n                    + t.substr(i + needle.length);\r\n            });\r\n        } else {\r\n            list = list.sort();\r\n        }\r\n        if (autocompleteShift > 0) {\r\n            // Put the current item to the top of the list.\r\n            // Use arrow keys to change `autocompleteShift`.\r\n            list = list.slice( autocompleteShift ).concat( list.slice( 0, autocompleteShift ) );\r\n        }\r\n        autocompleteProposals = list;\r\n\r\n        list.forEach(function (item, idx) {\r\n            var div = $.div();\r\n            div.innerHTML = item;\r\n            list[idx] = div.textContent.trim();\r\n            $.add( datalist, div );\r\n            $.on( div, {\r\n                down: function() {\r\n                    dataListHasFocus = true;\r\n                },\r\n                up: function() {\r\n                    dataListHasFocus = false;\r\n                    that.focus = true;\r\n                },\r\n                tap: function() {\r\n                    that.value = div.textContent.trim();\r\n                    console.info(\"[wdg.text] div=...\", div);\r\n                    $.removeClass( elem, 'list' );\r\n                }\r\n            });\r\n        });\r\n        if (list.length > 0) {\r\n            $.addClass( elem, \"list\" );\r\n        } else {\r\n            $.removeClass( elem, \"list\" );\r\n        }\r\n    };\r\n\r\n    var actionUpdateValue = LaterAction(function() {\r\n        if( !that.intl ) {\r\n            that.value = input.value;\r\n        } else {\r\n            that.value[lang.value] = input.value;\r\n            DB.fire( that, 'value', that.value );\r\n        }\r\n    }, 300);\r\n    input.addEventListener('keyup', function(evt) {\r\n        if (evt.keyCode == 13) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n            if ($.hasClass( elem, 'list' )) {\r\n                $.removeClass( elem, 'list' );\r\n                that.value = autocompleteProposals[0];\r\n            }\r\n            else if (that.valid !== false) {\r\n                DB.fire( that, 'value', input.value );\r\n                DB.fire( that, 'action', input.value );\r\n            }\r\n        }\r\n        else if (evt.keyCode == 27) {\r\n            $.removeClass( elem, \"list\" );\r\n            autocompleteShift = 0;\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else if (evt.keyCode == 40 && $.hasClass( elem, 'list' )) {\r\n            autocompleteShift = (autocompleteShift + 1) % autocompleteProposals.length;\r\n            complete();\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else if (evt.keyCode == 38 && $.hasClass( elem, 'list' )) {\r\n            autocompleteShift = (autocompleteShift + autocompleteProposals.length - 1)\r\n                % autocompleteProposals.length;\r\n            complete();\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n        }\r\n        else {\r\n            autocompleteShift = 0;\r\n            complete();\r\n            actionUpdateValue.fire();\r\n        }\r\n    });\r\n    input.addEventListener('blur', function() {\r\n        if( !that.intl ) {\r\n            that.value = input.value;\r\n        } else {\r\n            that.value[lang.value] = input.value;\r\n            DB.fire( that, 'value', that.value );\r\n        }\r\n        if (!dataListHasFocus) {\r\n            $.removeClass( elem, \"list\" );\r\n        }\r\n        $.addClass( elem, \"theme-elevation-2\" );\r\n        $.removeClass( elem, \"theme-elevation-8\" );\r\n        $.removeClass(input, 'theme-color-bg-A1');\r\n        that.focus = false;\r\n    });\r\n    input.addEventListener('focus', function() {\r\n        that.selectAll();\r\n        $.removeClass( elem, \"theme-elevation-2\" );\r\n        $.addClass( elem, \"theme-elevation-8\" );\r\n        $.addClass(input, 'theme-color-bg-A1');\r\n        that.focus = true;\r\n    });\r\n    input.addEventListener('keydown', function(evt) {\r\n    });\r\n\r\n    this.validate();\r\n};\r\n\r\n\r\n/**\r\n * Force value validation.\r\n */\r\nText.prototype.validate = function() {\r\n    var validator = this.validator;\r\n    if (!validator) return;\r\n    try {\r\n        this.valid = validator( this.value );\r\n    }\r\n    catch (ex) {\r\n        console.error(\"[wdg.text:validate] Exception = \", ex);\r\n        console.error(\"[wdg.text:validate] Validator = \", validator);\r\n    }\r\n};\r\n\r\n/**\r\n * Select whole text.\r\n * @return {this}\r\n */\r\nText.prototype.selectAll = function() {\r\n    var e = this._input;\r\n    e.setSelectionRange(0, e.value.length);\r\n    return true;\r\n};\r\n\r\nmodule.exports = Text;\r\n\r\n\r\n  \r\nmodule.exports._ = _;\n});"],"names":["require","module","exports","_","X","D","arguments","en","intl","all","$","DB","Lang","LaterAction","laterAction","Text","opts","that","this","dataListHasFocus","autocompleteProposals","autocompleteShift","label","div","input","tag","lang","small","visible","body","datalist","_input","elem","bind","v","value","focus","prop","isoLang","subset","push","validate","propBoolean","propEnum","att","type","propStringArray","console","info","clear","removeClass","Array","isArray","forEach","item","add","length","propValidator","validator","addClass","removeAtt","disabled","propInteger","size","propString","trim","textOrHtml","substr","title","placeholder","style","width","blur","propAddClass","propRemoveClass","extend","enabled","valid","list","wide","complete","map","String","toLowerCase","needle","itm","idx","indexOf","filter","sort","a","b","d","sa","sb","t","i","slice","concat","innerHTML","textContent","on","down","up","tap","actionUpdateValue","fire","addEventListener","evt","keyCode","preventDefault","stopPropagation","hasClass","selectAll","prototype","ex","error","e","setSelectionRange"],"mappings":"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"},"dependencies":["mod/$","mod/dom","mod/tfw.data-binding","mod/wdg.lang","mod/tfw.timer"]}